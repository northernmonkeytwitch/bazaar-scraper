<full updated server.js content from canvas>